name: Build

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  "Ubuntu":
    strategy:
      matrix:
        version:
          - 16.04
          - 18.04
          - 20.04
          - 21.04
          - 21.10
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: docker build --tag build:ubuntu-${{ matrix.version }} --build-arg version=${{ matrix.version }}
        name: "docker build"
        working-directory: docker/ubuntu
      - run: docker run --detach --interactive --name build --volume $PWD:/goestools build:ubuntu-${{ matrix.version }}
        name: "docker run"
      - run: docker exec -t build /run_cmake.sh
        name: "cmake"
      - run: docker exec -t build /run_compile.sh
        name: "make"
